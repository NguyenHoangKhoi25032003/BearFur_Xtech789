const products = [
    {
        name: "Bàn trang trí Mobilia BH-488",
        category: "Đèn trang trí",
        type: "Đèn thả trần",
        price: "6.190.000đ",
        oldPrice: "7.000.000đ",
        discount: "-12%",
        badge: "Hàng mới",
        image: "assets/img/cate_1_img.webp",
        imageHover: "assets/img/pr_1.webp",
    },
    {
        name: "Kệ 3 Tầng 290-3 Trắng",
        category: "Đèn trang trí",
        type: "Đèn thả trần",
        price: "1.790.000đ",
        oldPrice: "2.490.000đ",
        discount: "-28%",
        badge: "Hàng mới",
        image: "assets/img/cate_2_img.webp",
        imageHover: "assets/img/pr_1.webp",
    },
    {
        name: "Đèn thả trần nhà thủy tinh",
        category: "Đèn trang trí",
        type: "Đèn thả trần",
        price: "289.000đ",
        oldPrice: "525.000đ",
        discount: "-45%",
        badge: "Hàng mới",
        image: "assets/img/cate_3_img.webp",
        imageHover: "assets/img/pr_1.webp",
    },
    {
        name: "Chậu sứ trắng để bàn tròn",
        category: "Đèn trang trí",
        type: "Đèn thả trần",
        price: "150.000đ",
        oldPrice: "170.000đ",
        discount: "-12%",
        badge: "Hàng mới, Bán chạy",
        image: "assets/img/cate_4_img.webp",
        imageHover: "assets/img/pr_1.webp",
    },
    {
        name: "Bàn trang trí Mobilia BH-488",
        category: "Đèn trang trí",
        type: "Đèn thả trần",
        price: "6.190.000đ",
        oldPrice: "7.000.000đ",
        discount: "-12%",
        badge: "Hàng mới",
        image: "assets/img/cate_1_img.webp",
        imageHover: "assets/img/pr_1.webp",
    },
    {
        name: "Kệ 3 Tầng 290-3 Trắng",
        category: "Đèn trang trí",
        type: "Đèn thả trần",
        price: "1.790.000đ",
        oldPrice: "2.490.000đ",
        discount: "-28%",
        badge: "Hàng mới",
        image: "assets/img/cate_2_img.webp",
        imageHover: "assets/img/pr_1.webp",
    },
    {
        name: "Đèn thả trần nhà thủy tinh",
        category: "Đèn trang trí",
        type: "Đèn thả trần",
        price: "289.000đ",
        oldPrice: "525.000đ",
        discount: "-45%",
        badge: "Hàng mới",
        image: "assets/img/cate_3_img.webp",
        imageHover: "assets/img/pr_1.webp",
    },
    {
        name: "Chậu sứ trắng để bàn tròn",
        category: "Đèn trang trí",
        type: "Đèn thả trần",
        price: "150.000đ",
        oldPrice: "170.000đ",
        discount: "-12%",
        badge: "Hàng mới, Bán chạy",
        image: "assets/img/cate_4_img.webp",
        imageHover: "assets/img/pr_1.webp",
    },
    {
        name: "Bàn trang trí Mobilia BH-488",
        category: "Đèn trang trí",
        type: "Đèn thả trần",
        price: "6.190.000đ",
        oldPrice: "7.000.000đ",
        discount: "-12%",
        badge: "Hàng mới",
        image: "assets/img/cate_1_img.webp",
        imageHover: "assets/img/pr_1.webp",
    },
    {
        name: "Kệ 3 Tầng 290-3 Trắng",
        category: "Đèn trang trí",
        type: "Đèn thả trần",
        price: "1.790.000đ",
        oldPrice: "2.490.000đ",
        discount: "-28%",
        badge: "Hàng mới",
        image: "assets/img/cate_2_img.webp",
        imageHover: "assets/img/pr_1.webp",
    },
    {
        name: "Đèn thả trần nhà thủy tinh",
        category: "Đèn trang trí",
        type: "Đèn thả trần",
        price: "289.000đ",
        oldPrice: "525.000đ",
        badge: "Hàng mới",
        image: "assets/img/cate_3_img.webp",
        imageHover: "assets/img/pr_1.webp",
    },
    {
        name: "Chậu sứ trắng để bàn tròn",
        category: "Đèn trang trí",
        type: "Đèn thả trần",
        price: "150.000đ",
        oldPrice: "170.000đ",
        discount: "-12%",
        badge: "Hàng mới, Bán chạy",
        image: "assets/img/cate_4_img.webp",
        imageHover: "assets/img/pr_1.webp",
    },
    {
        name: "Bàn trang trí Mobilia BH-488",
        category: "Đèn trang trí",
        type: "Đèn thả trần",
        price: "6.190.000đ",
        oldPrice: "7.000.000đ",
        discount: "-12%",
        badge: "Hàng mới",
        image: "assets/img/cate_1_img.webp",
        imageHover: "assets/img/pr_1.webp",
    },
    {
        name: "Kệ 3 Tầng 290-3 Trắng",
        category: "Đèn trang trí",
        type: "Đèn thả trần",
        price: "1.790.000đ",
        oldPrice: "2.490.000đ",
        discount: "-28%",
        badge: "Hàng mới",
        image: "assets/img/cate_2_img.webp",
        imageHover: "assets/img/pr_1.webp",
    },
    {
        name: "Đèn thả trần nhà thủy tinh",
        category: "Đèn trang trí",
        type: "Đèn thả trần",
        price: "289.000đ",
        oldPrice: "525.000đ",
        discount: "-45%",
        badge: "Hàng mới",
        image: "assets/img/cate_3_img.webp",
        imageHover: "assets/img/pr_1.webp",
    },
    {
        name: "Chậu sứ trắng để bàn tròn",
        category: "Đèn trang trí",
        type: "Đèn thả trần",
        price: "150.000đ",
        oldPrice: "170.000đ",
        discount: "-12%",
        badge: "Hàng mới, Bán chạy",
        image: "assets/img/cate_4_img.webp",
        imageHover: "assets/img/pr_1.webp",
    },
];

function getParamsFromURL() {
    const params = new URLSearchParams(window.location.search);
    const category = params.get("category");
    const type = params.get("type");
    return { category, type };
}

document.addEventListener("DOMContentLoaded", () => {
    const { category, type } = getParamsFromURL();
    if (category) selectedCategory = category;
    if (type) selectedType = type;

    filterProducts();

    // Cập nhật tiêu đề hiển thị theo URL
    if (category && type) {
        updateTitles({
            hero: type,
            section: type,
            breadcrumb: `${category} › ${type}`
        });
    } else if (category) {
        updateTitles({
            hero: category,
            section: category,
            breadcrumb: category
        });
    }

   filterProducts();
});

const productsPerPage = 12;
let currentPage = 1;
let selectedCategory = null;
let selectedType = null;

function updateTitles({ hero, section, breadcrumb }) {
  const heroTitle = document.getElementById("hero-title");
  const breadcrumbTitle = document.getElementById("breadcrumb-title");
  const sectionTitle = document.getElementById("section-title");

  if (heroTitle) heroTitle.textContent = hero;
  if (breadcrumbTitle) breadcrumbTitle.textContent = breadcrumb;
  if (sectionTitle) sectionTitle.textContent = section.toUpperCase();
}

function filterProducts() {
    let filtered = products;

    if (selectedCategory) {
        filtered = filtered.filter(p => p.category === selectedCategory);
    }

    if (selectedType) {
        filtered = filtered.filter(p => p.type === selectedType);
    }

    currentPage = 1;
    renderProductsPage(currentPage, filtered);
    renderPagination(filtered);
}

document.querySelectorAll(".category-header").forEach(el => {
  el.addEventListener("click", () => {
    selectedCategory = el.dataset.category;
    selectedType = null;
    filterProducts();
    updateTitles({
      hero: selectedCategory,
      section: selectedCategory,
      breadcrumb: selectedCategory
    });
  });
});

document.querySelectorAll(".subcategory-item").forEach(el => {
  el.addEventListener("click", () => {
    selectedCategory = el.dataset.category;
    selectedType = el.dataset.type;
    filterProducts();
    updateTitles({
      hero: selectedType,
      section: selectedType,
      breadcrumb: `${selectedCategory} › ${selectedType}`
    });
  });
});

function renderProductsPage(page, filtered = products) {
    const container = document.getElementById("product-list");
    const start = (page - 1) * productsPerPage;
    const end = start + productsPerPage;
    const pageProducts = filtered.slice(start, end);
    if (pageProducts.length === 0) {
        container.innerHTML = '<p style="text-align:left; color:#888; padding:40px;">Không có sản phẩm nào phù hợp.</p>';
        document.getElementById("pagination").innerHTML = "";
        return;
    }

    container.innerHTML = pageProducts.map((p, index) => `
        <div class="product-card" data-index="${(page - 1) * productsPerPage + index}">
            <div class="discount-badge">${p.discount}</div>
            <div class="product-image">
                <img src="${p.image}" class="main">
                <img src="${p.imageHover}" class="hover">
                <div class="product-icons">
                    <button><i class="bi bi-cart"></i></button>
                    <button><i class="bi bi-search"></i></button>
                </div>
                ${p.badge.split(",").map(b =>
                    `<span class="product-badge ${b.trim() === "Bán chạy" ? "hot" : ""}">${b.trim()}</span>`
                ).join("")}
                <button class="wishlist-btn"><i class="bi bi-heart"></i></button>
            </div>
            <div class="product-info">
                <h4 class="product-title">${p.name}</h4>
                <div class="product-price">
                    <span class="current">${p.price}</span>
                    <span class="old">${p.oldPrice}</span>
                </div>
            </div>
        </div>
    `).join("");

    // Add click event listeners to product cards
    document.querySelectorAll(".product-card").forEach(card => {
        card.addEventListener("click", () => {
            const index = card.dataset.index;
            const product = filtered[index];
            const queryString = `?name=${encodeURIComponent(product.name)}&price=${encodeURIComponent(product.price)}&oldPrice=${encodeURIComponent(product.oldPrice)}&discount=${encodeURIComponent(product.discount)}&image=${encodeURIComponent(product.image)}&category=${encodeURIComponent(product.category)}&type=${encodeURIComponent(product.type)}&badge=${encodeURIComponent(product.badge)}`;
            window.location.href = `order.html${queryString}`;
        });
    });
}

function renderPagination(filtered = products) {
    const pagination = document.getElementById("pagination");
    const pageCount = Math.ceil(filtered.length / productsPerPage);
    pagination.innerHTML = "";

    for (let i = 1; i <= pageCount; i++) {
        const btn = document.createElement("button");
        btn.textContent = i;
        if (i === currentPage) btn.classList.add("active");
        btn.addEventListener("click", () => {
            currentPage = i;
            renderProductsPage(currentPage, filtered);
            renderPagination(filtered);
        });
        pagination.appendChild(btn);
    }
}

document.addEventListener("DOMContentLoaded", () => {
    renderProductsPage(currentPage);
    renderPagination();
});